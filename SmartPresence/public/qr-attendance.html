<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QR Code Attendance | CvSU Smart Presence</title>
  <link rel="stylesheet" href="css/qr-attendance.css" />
  <link rel="shortcut icon" href="img/favicon.png" type="image/x-icon" />
</head>
<body>
  <!-- ===== Header ===== -->
  <div class="qr-header">
    <button class="back-btn" onclick="history.back()">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" stroke="#006633" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <path d="M15 18l-6-6 6-6"/>
      </svg>
    </button>
    <h2 class="qr-title">QR Code Attendance</h2>
  </div>

  <!-- ===== Main Content ===== -->
  <div class="qr-container">
    <div class="qr-card">
      <div class="class-info">
        <h3 id="className">Loading...</h3>
        <p id="classSchedule">Schedule: Loading...</p>
      </div>

      <!-- Attendance Mode Selection -->
      <div class="attendance-mode-section">
        <label class="mode-label">Select Attendance Mode</label>
        <div class="mode-options">
          <div class="mode-card active" data-mode="automatic">
            <div class="mode-icon">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </div>
            <div class="mode-content">
              <h4>Automatic Mode</h4>
              <p>Time-based attendance tracking with automatic Present/Late/Absent status</p>
            </div>
            <div class="mode-check">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
          </div>
          
          <div class="mode-card" data-mode="faceRecognition">
            <div class="mode-icon">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="8" r="4" stroke="currentColor" stroke-width="2"/>
                <path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </div>
            <div class="mode-content">
              <h4>Face Recognition Mode</h4>
              <p>Advanced verification with facial recognition technology for secure attendance</p>
            </div>
            <div class="mode-check">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
          </div>
        </div>
      </div>

      <div class="qr-settings">
        <div class="time-setting">
          <label for="timeLimit">Time Limit (minutes):</label>
          <input type="number" id="timeLimit" min="1" max="60" value="10">
          <small>Students must scan within this time to be marked present</small>
        </div>

        <div class="grace-setting">
          <label for="graceTime">Grace Period (minutes):</label>
          <input type="number" id="graceTime" min="0" max="30" value="5">
          <small>Extra time after limit where students are marked late</small>
        </div>
      </div>

      <button id="generateQRBtn" class="generate-btn">Generate QR Code</button>

      <!-- Action Buttons (Now Outside QR Section) -->
      <div class="qr-actions">
        <button id="shareQRBtn" class="action-btn share-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM6 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm12 6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M8.59 13.51l6.83 3.98m-.01-10.98l-6.82 3.98" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Share QR Code
        </button>
        <button id="downloadQRBtn" class="action-btn download-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4m4-5l5 5 5-5m-5 5V3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Download QR Image
        </button>
        <button id="pauseSessionBtn" class="action-btn pause-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="6" y="4" width="4" height="16" fill="currentColor"/>
            <rect x="14" y="4" width="4" height="16" fill="currentColor"/>
          </svg>
          Pause
        </button>
        <button id="stopSessionBtn" class="action-btn stop-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="6" y="6" width="12" height="12" fill="currentColor"/>
          </svg>
          Stop Session
        </button>
      </div>

      <div id="qrCodeSection" class="qr-display hidden">
        <div class="qr-code-wrapper">
          <canvas id="qrCodeCanvas"></canvas>
          <div class="qr-mode-badge" id="qrModeBadge">Automatic Mode</div>
        </div>
        
        <div class="timer-section">
          <div class="timer-label">Session Active</div>
          <div id="timer" class="timer">10:00</div>
          <div class="timer-status">
            <span class="status-dot active"></span>
            <span id="timerStatus">On Time Period</span>
          </div>
        </div>
      </div>

      <!-- Real-time Attendance List -->
      <div id="attendanceList" class="attendance-list hidden">
        <h4>Real-time Attendance</h4>
        <div class="attendance-summary">
          <div class="summary-item present">
            <span class="count" id="presentCount">0</span>
            <span class="label">Present</span>
          </div>
          <div class="summary-item late">
            <span class="count" id="lateCount">0</span>
            <span class="label">Late</span>
          </div>
          <div class="summary-item absent">
            <span class="count" id="absentCount">0</span>
            <span class="label">Absent</span>
          </div>
        </div>
        <div id="studentAttendanceList" class="student-attendance-rows"></div>
      </div>
    </div>
  </div>

  <!-- ===== Scripts ===== -->
  <script type="module" src="js/qr-attendance.js"></script>
  <script type="module" src="js/navigation.js"></script>
</body>
</html>